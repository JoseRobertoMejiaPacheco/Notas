{"ops":[{"insert":"# Use backports to avoid install some libs with pip"},{"attributes":{"code-block":true},"insert":"\n"},{"insert":"echo 'deb http://deb.debian.org/debian stretch-backports main' > /etc/apt/sources.list.d/backports.list"},{"attributes":{"code-block":true},"insert":"\n"},{"insert":"#Creamos el usuario y grupo de sistema 'odoo':"},{"attributes":{"code-block":true},"insert":"\n"},{"insert":"adduser --system --quiet --shell=/bin/bash --home=/opt/odoo --gecos 'odoo' --group odoo"},{"attributes":{"code-block":true},"insert":"\n"},{"insert":"#Creamos en directorio en donde se almacenará el archivo de configuración y log de odoo::"},{"attributes":{"code-block":true},"insert":"\n"},{"insert":"mkdir /etc/odoo && mkdir /var/log/odoo/"},{"attributes":{"code-block":true},"insert":"\n\n"},{"insert":"# Install some deps, lessc and less-plugin-clean-css, and wkhtmltopdf"},{"attributes":{"code-block":true},"insert":"\n"},{"insert":"set -x; \\"},{"attributes":{"code-block":true},"insert":"\n"},{"insert":"        apt-get update \\"},{"attributes":{"code-block":true},"insert":"\n"},{"insert":"        && apt-get install -y --no-install-recommends \\"},{"attributes":{"code-block":true},"insert":"\n"},{"insert":"            ca-certificates \\"},{"attributes":{"code-block":true},"insert":"\n"},{"insert":"            curl \\"},{"attributes":{"code-block":true},"insert":"\n"},{"insert":"            dirmngr \\"},{"attributes":{"code-block":true},"insert":"\n"},{"insert":"            fonts-noto-cjk \\"},{"attributes":{"code-block":true},"insert":"\n"},{"insert":"            gnupg \\"},{"attributes":{"code-block":true},"insert":"\n"},{"insert":"            libssl1.0-dev \\"},{"attributes":{"code-block":true},"insert":"\n"},{"insert":"            node-less \\"},{"attributes":{"code-block":true},"insert":"\n"},{"insert":"            python3-num2words \\"},{"attributes":{"code-block":true},"insert":"\n"},{"insert":"            python3-pip \\"},{"attributes":{"code-block":true},"insert":"\n"},{"insert":"            python3-phonenumbers \\"},{"attributes":{"code-block":true},"insert":"\n"},{"insert":"            python3-pyldap \\"},{"attributes":{"code-block":true},"insert":"\n"},{"insert":"            python3-qrcode \\"},{"attributes":{"code-block":true},"insert":"\n"},{"insert":"            python3-renderpm \\"},{"attributes":{"code-block":true},"insert":"\n"},{"insert":"            python3-setuptools \\"},{"attributes":{"code-block":true},"insert":"\n"},{"insert":"            python3-vobject \\"},{"attributes":{"code-block":true},"insert":"\n"},{"insert":"            python3-watchdog \\"},{"attributes":{"code-block":true},"insert":"\n"},{"insert":"            python3-xlwt \\"},{"attributes":{"code-block":true},"insert":"\n"},{"insert":"            python3-xlrd \\"},{"attributes":{"code-block":true},"insert":"\n"},{"insert":"            python3-unicodecsv \\"},{"attributes":{"code-block":true},"insert":"\n"},{"insert":"            python3-unidecode \\"},{"attributes":{"code-block":true},"insert":"\n"},{"insert":"            xz-utils \\"},{"attributes":{"code-block":true},"insert":"\n"},{"insert":"            libsasl2-dev \\"},{"attributes":{"code-block":true},"insert":"\n"},{"insert":"            python3-dev \\"},{"attributes":{"code-block":true},"insert":"\n"},{"insert":"            libldap2-dev \\"},{"attributes":{"code-block":true},"insert":"\n"},{"insert":"            libssl-dev \\"},{"attributes":{"code-block":true},"insert":"\n\n\n\n\n\n"},{"insert":"        && curl -o wkhtmltox.deb -sSL https://github.com/wkhtmltopdf/wkhtmltopdf/releases/download/0.12.5/wkhtmltox_0.12.5-1.stretch_amd64.deb \\"},{"attributes":{"code-block":true},"insert":"\n"},{"insert":"        && echo '7e35a63f9db14f93ec7feeb0fce76b30c08f2057 wkhtmltox.deb' | sha1sum -c - \\"},{"attributes":{"code-block":true},"insert":"\n"},{"insert":"        && apt-get install -y --no-install-recommends ./wkhtmltox.deb \\"},{"attributes":{"code-block":true},"insert":"\n"},{"insert":"        && rm -rf /var/lib/apt/lists/* wkhtmltox.deb"},{"attributes":{"code-block":true},"insert":"\n\n"},{"insert":"# Instalamos Git"},{"attributes":{"code-block":true},"insert":"\n"},{"insert":"apt-get update && apt-get install -y git"},{"attributes":{"code-block":true},"insert":"\n"},{"insert":"git clone --depth 1 --branch 11.0 https://github.com/odoo/odoo /opt/odoo/odoo"},{"attributes":{"code-block":true},"insert":"\n\n"},{"insert":"chown odoo:odoo /opt/odoo/ -R && chown odoo:odoo /var/log/odoo/ -R && cd /opt/odoo/odoo && pip3 install -r requirements.txt"},{"attributes":{"code-block":true},"insert":"\n"},{"insert":"mkdir /opt/odoo/odoo/custom_addons"},{"attributes":{"code-block":true},"insert":"\n"},{"insert":"mkdir /opt/odoo/odoo/extra_localization"},{"attributes":{"code-block":true},"insert":"\n"},{"insert":"chown odoo:odoo /opt/odoo/odoo/custom_addons -R"},{"attributes":{"code-block":true},"insert":"\n"},{"insert":"chown odoo:odoo /opt/odoo/odoo/extra_localization -R"},{"attributes":{"code-block":true},"insert":"\n"},{"insert":"ln -s /usr/local/bin/wkhtmltopdf /usr/bin/"},{"attributes":{"code-block":true},"insert":"\n"},{"insert":"ln -s /usr/local/bin/wkhtmltoimage /usr/bin/"},{"attributes":{"code-block":true},"insert":"\n\n"},{"insert":"apt-get install postgresql-client"},{"attributes":{"code-block":true},"insert":"\n"},{"insert":"#Crea y guarda la configuracion y agrega los parametros al archivo de configuracion inicia y para el servicio a la vez"},{"attributes":{"code-block":true},"insert":"\n"},{"insert":"#Verlos en /odoo-bin -h"},{"attributes":{"code-block":true},"insert":"\n"},{"insert":"su - odoo -c \"/opt/odoo/odoo/odoo-bin --addons-path=/opt/odoo/odoo/addons -s --stop-after-init\""},{"attributes":{"code-block":true},"insert":"\n"},{"insert":"mv /opt/odoo/.odoorc /etc/odoo/odoo.conf"},{"attributes":{"code-block":true},"insert":"\n"},{"insert":"ln -s /opt/odoo/odoo/odoo-bin /usr/bin/odoo"},{"attributes":{"code-block":true},"insert":"\n"},{"insert":"su - odoo -c \"/opt/odoo/odoo/odoo-bin --addons-path=/opt/odoo/odoo/addons -s --stop-after-init\""},{"attributes":{"code-block":true},"insert":"\n\n"},{"insert":"VOLUME [\"/opt/odoo/odoo/addons\", \"/opt/odoo/odoo/extra_localization\"]"},{"attributes":{"code-block":true},"insert":"\n"},{"insert":"EXPOSE 8069 8071"},{"attributes":{"code-block":true},"insert":"\n"},{"insert":"ENV ODOO_RC /etc/odoo/odoo.conf"},{"attributes":{"code-block":true},"insert":"\n"},{"insert":"COPY wait-for-psql.py /usr/local/bin/wait-for-psql.py"},{"attributes":{"code-block":true},"insert":"\n"},{"insert":"USER odoo"},{"attributes":{"code-block":true},"insert":"\n"},{"insert":"ENTRYPOINT [\"/entrypoint.sh\"]"},{"attributes":{"code-block":true},"insert":"\n"},{"insert":"CMD [\"odoo\"]"},{"attributes":{"code-block":true},"insert":"\n\n\n"},{"insert":"\n\n"}]}