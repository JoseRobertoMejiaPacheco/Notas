{"ops":[{"insert":"select * from account_move_line where id in(376291, 369921, 370064, 336090, 289200, 281331, 227217, 136611, 129706, 129670, 129658, 129644, 129527, 129513, 129501, 129458, 41003)"},{"attributes":{"code-block":true},"insert":"\n"},{"insert":"Poner la columna amount_residual_currency en 0\n\n con los ids obtenidos desde \n/opt/odoo/odoo/addons/account/models/account_invoice.py\n\n\n    @api.one"},{"attributes":{"code-block":true},"insert":"\n"},{"insert":"    def _get_outstanding_info_JSON(self):"},{"attributes":{"code-block":true},"insert":"\n"},{"insert":"        self.outstanding_credits_debits_widget = json.dumps(False)"},{"attributes":{"code-block":true},"insert":"\n"},{"insert":"        if self.state == 'open':"},{"attributes":{"code-block":true},"insert":"\n"},{"insert":"            domain = [('account_id', '=', self.account_id.id),"},{"attributes":{"code-block":true},"insert":"\n"},{"insert":"                      ('partner_id', '=', self.env['res.partner']._find_accounting_partner(self.partner_id).id),"},{"attributes":{"code-block":true},"insert":"\n"},{"insert":"                      ('reconciled', '=', False),"},{"attributes":{"code-block":true},"insert":"\n"},{"insert":"                      ('move_id.state', '=', 'posted'),"},{"attributes":{"code-block":true},"insert":"\n"},{"insert":"                      '|',"},{"attributes":{"code-block":true},"insert":"\n"},{"insert":"                        '&', ('amount_residual_currency', '!=', 0.0), ('currency_id','!=', None),"},{"attributes":{"code-block":true},"insert":"\n"},{"insert":"                        '&', ('amount_residual_currency', '=', 0.0), '&', ('currency_id','=', None), ('amount_residual', '!=', 0.0)]"},{"attributes":{"code-block":true},"insert":"\n"},{"insert":"            if self.type in ('out_invoice', 'in_refund'):"},{"attributes":{"code-block":true},"insert":"\n"},{"insert":"                domain.extend([('credit', '>', 0), ('debit', '=', 0)])"},{"attributes":{"code-block":true},"insert":"\n"},{"insert":"                type_payment = _('Outstanding credits')"},{"attributes":{"code-block":true},"insert":"\n"},{"insert":"            else:"},{"attributes":{"code-block":true},"insert":"\n"},{"insert":"                domain.extend([('credit', '=', 0), ('debit', '>', 0)])"},{"attributes":{"code-block":true},"insert":"\n"},{"insert":"                type_payment = _('Outstanding debits')"},{"attributes":{"code-block":true},"insert":"\n"},{"insert":"            info = {'title': '', 'outstanding': True, 'content': [], 'invoice_id': self.id}"},{"attributes":{"code-block":true},"insert":"\n"},{"insert":"            lines = self.env['account.move.line'].search(domain)"},{"attributes":{"code-block":true},"insert":"\n"},{"insert":"            print(lines)"},{"attributes":{"code-block":true},"insert":"\n"},{"insert":"            currency_id = self.currency_id"},{"attributes":{"code-block":true},"insert":"\n"},{"insert":"            if len(lines) != 0:"},{"attributes":{"code-block":true},"insert":"\n"},{"insert":"                for line in lines:"},{"attributes":{"code-block":true},"insert":"\n"},{"insert":"                    # get the outstanding residual value in invoice currency"},{"attributes":{"code-block":true},"insert":"\n"},{"insert":"                    if line.currency_id and line.currency_id == self.currency_id:"},{"attributes":{"code-block":true},"insert":"\n"},{"insert":"                        amount_to_show = abs(line.amount_residual_currency)"},{"attributes":{"code-block":true},"insert":"\n"},{"insert":"                    else:"},{"attributes":{"code-block":true},"insert":"\n"},{"insert":"                        amount_to_show = line.company_id.currency_id.with_context(date=line.date).compute(abs(line.amount_residual), self.currency_id)"},{"attributes":{"code-block":true},"insert":"\n"},{"insert":"                    if float_is_zero(amount_to_show, precision_rounding=self.currency_id.rounding):"},{"attributes":{"code-block":true},"insert":"\n"},{"insert":"                        continue"},{"attributes":{"code-block":true},"insert":"\n"},{"insert":"                    if line.ref :"},{"attributes":{"code-block":true},"insert":"\n"},{"insert":"                        title = '%s : %s' % (line.move_id.name, line.ref)"},{"attributes":{"code-block":true},"insert":"\n"},{"insert":"                    else:"},{"attributes":{"code-block":true},"insert":"\n"},{"insert":"                        title = line.move_id.name"},{"attributes":{"code-block":true},"insert":"\n"},{"insert":"                    info['content'].append({"},{"attributes":{"code-block":true},"insert":"\n"},{"insert":"                        'journal_name': line.ref or line.move_id.name,"},{"attributes":{"code-block":true},"insert":"\n"},{"insert":"                        'title': title,"},{"attributes":{"code-block":true},"insert":"\n"},{"insert":"                        'amount': amount_to_show,"},{"attributes":{"code-block":true},"insert":"\n"},{"insert":"                        'currency': currency_id.symbol,"},{"attributes":{"code-block":true},"insert":"\n"},{"insert":"                        'id': line.id,"},{"attributes":{"code-block":true},"insert":"\n"},{"insert":"                        'position': currency_id.position,"},{"attributes":{"code-block":true},"insert":"\n"},{"insert":"                        'digits': [69, self.currency_id.decimal_places],"},{"attributes":{"code-block":true},"insert":"\n"},{"insert":"                    })"},{"attributes":{"code-block":true},"insert":"\n"},{"insert":"                info['title'] = type_payment"},{"attributes":{"code-block":true},"insert":"\n"},{"insert":"                self.outstanding_credits_debits_widget = json.dumps(info)"},{"attributes":{"code-block":true},"insert":"\n"},{"insert":"                print(json.dumps(info))"},{"attributes":{"code-block":true},"insert":"\n"},{"insert":"                self.has_outstanding = True"},{"attributes":{"code-block":true},"insert":"\n\n"}]}